<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AKT Labs • Índice de Calculadoras</title>
  <meta name="description" content="Índice automático das páginas deste repositório." />
  <link rel="preconnect" href="https://api.github.com" crossorigin>
  <style>
    :root{
      --bg:#0b0d10;--panel:#11151a;--muted:#9aa4b2;--text:#e6edf3;--brand:#00e0b8;--card:#141a21;--card2:#10151b;--stroke:#1f2833;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg, rgba(6,8,10,.9), rgba(6,8,10,.6)), radial-gradient(1200px 800px at 100% -10%, rgba(0,224,184,.08), transparent 60%), var(--bg);color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .container{max-width:1100px;margin:0 auto;padding:28px}
    header{display:flex;gap:18px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:conic-gradient(from 210deg at 50% 50%, var(--brand), #2df0ff, #9fffd6);box-shadow:0 0 0 2px #0e1318,0 10px 30px rgba(0,224,184,.3)}
    h1{margin:0;font-size:22px;letter-spacing:.3px}
    .muted{color:var(--muted)}
    .panel{margin-top:18px;background:linear-gradient(180deg, rgba(255,255,255,.02), transparent), var(--panel);border:1px solid var(--stroke);border-radius:16px;padding:14px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .search{flex:1 1 260px;display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--stroke);border-radius:12px;padding:10px 12px}
    .search input{all:unset;flex:1;color:var(--text)}
    .pill{padding:8px 12px;border-radius:999px;background:var(--card2);border:1px solid var(--stroke);font-size:13px}
    .grid{display:grid;grid-template-columns:repeat(1,minmax(0,1fr));gap:14px;margin-top:16px}
    @media(min-width:640px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:960px){.grid{grid-template-columns:repeat(3,minmax(0,1fr))}}
    .card{position:relative;overflow:hidden;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,.03), transparent 60%), var(--card);border:1px solid var(--stroke)}
    .card:hover{border-color:rgba(0,224,184,.6);box-shadow:0 6px 26px rgba(0,224,184,.15)}
    .card a{display:block;color:inherit;text-decoration:none;padding:16px 16px 18px 16px}
    .path{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .title{margin-top:6px;font-weight:700;font-size:16px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .meta{margin-top:8px;font-size:12px;color:var(--muted);display:flex;align-items:center;gap:10px}
    .badge{font-size:11px;padding:4px 8px;border-radius:999px;background:rgba(0,224,184,.12);color:#9fffd6;border:1px solid rgba(0,224,184,.35)}
    footer{margin:28px 0 10px;color:var(--muted);font-size:13px}
    .error{background:#241317;border:1px solid #6a1a26;color:#ffd5db;padding:12px 14px;border-radius:12px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>AKT Labs • Índice de Calculadoras</h1>
          <div class="muted" id="repoName">tdmndez-a11y/calculadoras-akt-labs</div>
        </div>
      </div>
      <div class="pill" id="count">0 páginas</div>
    </header>

    <div class="panel">
      <div class="search" title="Pesquisar por nome do arquivo ou pasta">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.5"/></svg>
        <input id="q" placeholder="Buscar páginas .html…" autocomplete="off" />
      </div>
      <a class="pill" id="openSite" target="_blank" rel="noopener">Abrir site</a>
      <a class="pill" id="openRepo" target="_blank" rel="noopener">Abrir repositório</a>
    </div>

    <div id="results" class="grid" aria-live="polite"></div>

    <div id="fallback" style="display:none;margin-top:16px" class="error"></div>

    <footer>
      <span>Gera automaticamente links para todos os arquivos <code>.html</code> (exceto este <code>index.html</code>) do repositório, em qualquer pasta.</span>
    </footer>
  </div>

  <script>
    // ====== CONFIG ======
    const OWNER = 'tdmndez-a11y';
    const REPO  = 'calculadoras-akt-labs';
    const SITE_ROOT = `https://${OWNER}.github.io/${REPO}/`;
    const API_ROOT  = `https://api.github.com/repos/${OWNER}/${REPO}/contents`;

    // ====== STATE ======
    const pages = []; // { path, name, dir }

    // ====== DOM ======
    const resultsEl = document.getElementById('results');
    const countEl   = document.getElementById('count');
    const openSite  = document.getElementById('openSite');
    const openRepo  = document.getElementById('openRepo');
    const qEl       = document.getElementById('q');
    const fallback  = document.getElementById('fallback');

    openSite.href = SITE_ROOT;
    openRepo.href = `https://github.com/${OWNER}/${REPO}`;

    // ====== HELPERS ======
    function isHtml(name){ return name.toLowerCase().endsWith('.html'); }
    function toTitle(name){
      return name
        .replace(/\.html$/i,'')
        .replace(/[-_]/g,' ')
        .replace(/\s+/g,' ')
        .trim()
        .replace(/\b\w/g, c => c.toUpperCase());
    }

    function makeCard(item){
      const url = SITE_ROOT + encodeURI(item.path);
      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = `
        <a href="${url}" target="_blank" rel="noopener">
          <div class="path">/${item.dir || ''}</div>
          <div class="title">${toTitle(item.name)}</div>
          <div class="meta">
            <span class="badge">${item.name}</span>
            <span>${item.dir ? '• ' + item.dir : ''}</span>
          </div>
        </a>`;
      return el;
    }

    function render(list){
      resultsEl.innerHTML = '';
      if(!list.length){
        const div = document.createElement('div');
        div.className = 'muted';
        div.style.padding='12px';
        div.textContent = 'Nenhuma página encontrada para o filtro atual.';
        resultsEl.appendChild(div);
      } else {
        list.forEach(item => resultsEl.appendChild(makeCard(item)));
      }
      countEl.textContent = `${list.length} página${list.length===1?'':'s'}`;
    }

    function filter(term){
      term = term.trim().toLowerCase();
      if(!term) return pages;
      return pages.filter(p =>
        p.name.toLowerCase().includes(term) ||
        (p.dir && p.dir.toLowerCase().includes(term)) ||
        p.path.toLowerCase().includes(term)
      );
    }

    qEl.addEventListener('input', () => render(filter(qEl.value)) );

    // ====== FETCH (recursive) ======
    async function crawl(path=''){
      const url = API_ROOT + (path ? `/${encodeURIComponent(path)}` : '');
      const res = await fetch(url, { headers: { 'Accept':'application/vnd.github+json' } });
      if(!res.ok) throw new Error(`${res.status} ${res.statusText}`);
      const items = await res.json();
      for(const it of items){
        if(it.type === 'dir'){
          await crawl(it.path);
        } else if(it.type === 'file' && isHtml(it.name)){
          if(it.name.toLowerCase() === 'index.html') continue; // evita se listar
          const parts = it.path.split('/');
          const name = parts.pop();
          const dir  = parts.join('/');
          pages.push({ path: it.path, name, dir });
        }
      }
    }

    (async function init(){
      try{
        await crawl('');
        // ordena: raiz primeiro, depois por pasta e nome
        pages.sort((a,b)=>{
          if((a.dir||'') !== (b.dir||'')) return (a.dir||'').localeCompare(b.dir||'');
          return a.name.localeCompare(b.name);
        });
        render(pages);
      } catch(err){
        console.error(err);
        fallback.style.display = 'block';
        fallback.innerHTML = `Falha ao listar arquivos via GitHub API.<br>\
          Você ainda pode criar links manualmente aqui se preferir.`;
        render([]);
      }
    })();
  </script>
</body>
</html>
